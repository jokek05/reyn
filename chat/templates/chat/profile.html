{% extends 'base.html' %}

{% block content %}
<div class="profile-container">
    <h1>–ü—Ä–æ—Ñ–∏–ª—å {{ profile_user.username }}</h1>

    <div style="text-align: center;">
        {% if profile_user.profile.avatar %}
            <img src="{{ profile_user.profile.avatar.url }}" alt="{{ profile_user.username }}" style="max-width: 150px; border-radius: 50%;">
        {% else %}
            <img src="/static/default-avatar.png" alt="–ù–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞" style="max-width: 150px; border-radius: 50%;">
        {% endif %}
    </div>

    {% if profile_user == user %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            {{ form.display_name.label_tag }}<br>
            {{ form.display_name }}<br><br>

            <label for="id_avatar">–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label><br>
            <input type="file" id="id_avatar" name="avatar" style="display:none;" 
                onchange="document.getElementById('filename').textContent = this.files[0]?.name || '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';">
            <button type="button" onclick="document.getElementById('id_avatar').click();">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>

            <button type="submit">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </form>
    {% else %}
        {% if form %}
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.display_name.label_tag }}<br>
                {{ form.display_name }}<br>
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö</button>
            </form>
        {% else %}
            <p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º—è –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.</p>
        {% endif %}

        <p>Email: {{ profile_user.email }}</p>

        <a href="{% url 'chat_with_user' profile_user.id %}" class="btn-chat-with-user">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</a>
    {% endif %}

    {% if profile_user == user %}
        <div class="profile-actions">
            <a href="{% url 'index' %}">üó®Ô∏è –ú–æ–∏ —á–∞—Ç—ã</a><br>
            <a href="{% url 'contacts' %}">üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã</a><br>
            <a href="{% url 'create_chat' %}">‚ûï –ù–æ–≤—ã–π —á–∞—Ç</a><br>
        </div>
    {% endif %}
</div>

<script>
    // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏), –ø–æ–∫–∞–∂–µ–º –µ–≥–æ –∏–º—è
    const fileInput = document.getElementById('id_avatar');
    const fileNameSpan = document.getElementById('filename');
    if (fileInput && fileInput.files.length > 0) {
        fileNameSpan.textContent = fileInput.files[0].name;
    }
</script>
{% endblock %}
